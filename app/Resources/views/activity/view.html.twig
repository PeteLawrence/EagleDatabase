{% extends 'base.html.twig' %}

{% block title %}{{ activity.name }}{% endblock %}

{% block breadcrumbs %}
<nav class="breadcrumb">
    <a class="breadcrumb-item" href="/">Home</a>
    <a class="breadcrumb-item" href="{{ path('activity_index') }}">Activities</a>
    <span class="breadcrumb-item active">{{ activity.name }}</span>
</nav>
{% endblock %}

{% block body %}
    <h2>{{ activity.name }}</h2>

    <div class="col-xs-8">
        <div class="card">
            <h4 class="card-header">Summary</h4>
            <div class="card-block">
                <ul>
                    <li><strong>Start</strong> {{ activity.activityStart|date('d M Y H:i')}}</li>
                    <li><strong>End</strong> {{ activity.activityEnd|date('d M Y H:i')}}</li>
                    <li><strong>Places</strong> {{ activity.getSpaces }}</li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h4 class="card-header">Description</h4>
            <div class="card-block">
                {{ activity.description }}
            </div>
        </div>

        <div class="card">
            <h4 class="card-header">Weather</h4>
            <div class="card-block" style="height: 170px; overflow-y: scroll;">
                <table class="table table-sm">
                    {% for dataPoint in activity.weatherDataPoints %}
                        <tr>
                            <td class="h2">{{ dataPoint.time|date('H:i', dataPoint.timeZone) }}</td>
                            <td>
                                <i class="wi wi-forecast-io-{{dataPoint.icon}} h2"></i>
                                {% if dataPoint.precipitationIntensity > 0 %}
                                    <sub>{{ dataPoint.precipitationIntensity }} mm/h</sub>
                                {% endif %}
                            </td>
                            <td>
                                <i class="wi wi-thermometer h2"></i>
                                <span class="h2">{{ dataPoint.temperature|number_format(1) }}</span>
                                <sup>°C</sup>
                            </td>
                            <td>
                                <i class="wi wi-wind towards-{{dataPoint.windBearing}}-deg h2" title="{{dataPoint.windBearing}}°"></i>
                                <span class="h2">{{ dataPoint.windSpeed|number_format(1) }}</span>
                                <sup>km/h</sup>
                            </td>
                        </tr>
                    {% endfor %}
                </table>

            </div>
        </div>
    </div>

    <div class="col-xs-4">
        <div class="card">
            <h4 class="card-header">Map</h4>
            <div class="card-block">
                <div id="map" style="width: 100%; height: 300px;"></div>
            </div>
        </div>
    </div>

{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.9/css/weather-icons.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.9/css/weather-icons-wind.min.css" />
{% endblock %}


{% block javascripts %}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_key }}&callback=initMap" async defer></script>
    <script>
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'));

        var startPos = {lat: {{activity.startLocation.latitude}}, lng: {{ activity.startLocation.longitude}}};
        var endPos = {lat: {{activity.endLocation.latitude}}, lng: {{ activity.endLocation.longitude}}};

        var start = new google.maps.Marker({
          position: startPos,
          map: map,
          title: 'Start'
        });

        var end = new google.maps.Marker({
          position: endPos,
          map: map,
          title: 'End'
        });

        var bounds = new google.maps.LatLngBounds();
        bounds.extend(startPos)
        bounds.extend(endPos);
        map.fitBounds(bounds);

        google.maps.event.addListenerOnce(map, 'bounds_changed', function(event) {
          if (map.getZoom() > 15) {
            map.setZoom(15);
          }
        });

      }
    </script>
{% endblock %}
